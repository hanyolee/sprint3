<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>ìƒí’ˆ ì¡°íšŒ í˜ì´ì§€</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
      }
      #result {
        margin-top: 20px;
        padding: 10px;
        border: 1px solid #ddd;
        background: #fafafa;
      }
    </style>
  </head>
  <body>
    <h1>ìƒí’ˆ ì¡°íšŒ</h1>

    <form id="productForm">
      <input type="text" id="name" placeholder="ìƒí’ˆëª…" />
      <input type="number" id="price" placeholder="ê°€ê²©" />
      <input type="text" id="description" placeholder="ìƒí’ˆ ì„¤ëª…" />
      <button type="submit">ì¡°íšŒ</button>
    </form>

    <!-- ì¡°íšŒ ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
    <div id="result">ì¡°íšŒ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>

    <script>
      const form = document.getElementById("productForm");
      const resultBox = document.getElementById("result");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const name = document.getElementById("name").value;
        const price = document.getElementById("price").value;
        const description = document.getElementById("description").value;

        // ë°±ì—”ë“œì—ì„œ ì‚¬ìš©í•˜ëŠ” ì¿¼ë¦¬ í‚¤ì™€ ë§ì¶”ê¸° (name, price, description ...)
        const params = {};
        if (name) params.name = name;
        if (price) params.price = price;
        if (description) params.description = description;

        const query = new URLSearchParams(params).toString();

        // ğŸ”¥ productRouter ì˜ /search ì‚¬ìš©
        const res = await fetch(`/api/products/search?${query}`, {
          method: "GET",
        });

        const data = await res.json();
        console.log("response:", data);

        // ì‘ë‹µ êµ¬ì¡°ê°€ [ë°°ì—´] ì´ê±°ë‚˜ { product: [] } ì¸ ê²½ìš° ë‘˜ ë‹¤ ì²˜ë¦¬
        let list = [];

        if (Array.isArray(data)) {
          list = data;
        } else if (Array.isArray(data.product)) {
          list = data.product;
        } else if (Array.isArray(data.products)) {
          list = data.products;
        }

        if (!list.length) {
          resultBox.innerHTML = "<p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
          return;
        }

        resultBox.innerHTML = list
          .map(
            (item) => `
          <div style="padding: 8px; border-bottom: 1px solid #ddd;">
            <strong>ID:</strong> ${item.id}<br>
            <strong>ì´ë¦„:</strong> ${item.name}<br>
            <strong>ê°€ê²©:</strong> ${item.price}<br>
            ${
              item.description
                ? `<strong>ì„¤ëª…:</strong> ${item.description}<br>`
                : ""
            }
          </div>
        `
          )
          .join("");
      });
    </script>
  </body>
</html>
